<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>iValentine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* --- CORE SYSTEM --- */
        :root {
            --ios-bg: #000000;
            --ios-card: rgba(28, 28, 30, 0.65);
            --ios-blue: #0A84FF;
            --ios-green: #30D158;
            --ios-pink: #FF375F;
            --chocolate: #5D4037;
            --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --ease-smooth: cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
            background-color: black;
            color: white;
            height: 100dvh;
            width: 100vw;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- WALLPAPER ENGINE --- */
        .wallpaper {
            position: fixed;
            inset: 0;
            z-index: -1;
            background:
                radial-gradient(at 0% 0%, #4b1a26 0%, transparent 50%),
                radial-gradient(at 100% 100%, #1a3b4b 0%, transparent 50%),
                linear-gradient(180deg, #000000 0%, #1c1c1e 100%);
            transition: transform 0.5s;
        }

        .glass-panel {
            background: rgba(30, 30, 30, 0.7);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 20px 50px -10px rgba(0, 0, 0, 0.5);
        }

        /* --- SCENE MANAGER --- */
        .scene {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transform: scale(0.92);
            transition: opacity 0.5s var(--ease-smooth), transform 0.5s var(--ease-smooth);
            padding: env(safe-area-inset-top) 20px env(safe-area-inset-bottom) 20px;
        }

        .scene.active {
            opacity: 1;
            pointer-events: all;
            transform: scale(1);
            z-index: 10;
        }

        /* --- DYNAMIC ISLAND --- */
        #dynamic-island {
            position: fixed;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            height: 36px;
            width: 120px;
            background: black;
            border-radius: 18px;
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.5s var(--ease-spring);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        #dynamic-island.music-mode {
            width: 160px;
        }

        #dynamic-island.choco-mode {
            width: 340px;
            height: 70px;
            border-radius: 35px;
            background: #2c1e1a;
        }

        #dynamic-island.pay-mode {
            width: 200px;
            height: 50px;
            border-radius: 25px;
            background: #1c1c1e;
            border: 1px solid #333;
        }

        .island-content {
            opacity: 0;
            display: none;
            width: 100%;
            height: 100%;
            padding: 0 20px;
            align-items: center;
            justify-content: space-between;
        }

        .show-content {
            opacity: 1;
            display: flex;
            animation: fadeIn 0.3s forwards;
        }

        .wave-bars {
            display: flex;
            gap: 3px;
            align-items: center;
            height: 100%;
        }

        .bar {
            width: 3px;
            background: var(--ios-green);
            border-radius: 2px;
            height: 5px;
        }

        .playing .bar {
            animation: sound 0.8s ease-in-out infinite;
        }

        .bar:nth-child(1) {
            animation-delay: 0.1s;
        }

        .bar:nth-child(2) {
            animation-delay: 0.2s;
        }

        .bar:nth-child(3) {
            animation-delay: 0.3s;
        }

        @keyframes sound {

            0%,
            100% {
                height: 5px;
            }

            50% {
                height: 18px;
            }
        }

        /* --- VECTOR CHARACTERS --- */
        .char-wrapper {
            position: relative;
            width: 100px;
            height: 90px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }

        /* Chiikawa */
        .c-body {
            position: absolute;
            inset: 0;
            background: white;
            border: 2.5px solid #1D1D1F;
            border-radius: 48% 48% 44% 44%;
        }

        .c-ear {
            position: absolute;
            top: -8px;
            width: 24px;
            height: 24px;
            background: white;
            border: 2.5px solid #1D1D1F;
            border-radius: 50%;
            z-index: -1;
        }

        .c-ear.l {
            left: 10px;
        }

        .c-ear.r {
            right: 10px;
        }

        .c-eye {
            width: 7px;
            height: 7px;
            background: #1D1D1F;
            border-radius: 50%;
            position: absolute;
            top: 45%;
        }

        .c-eye.l {
            left: 30%;
        }

        .c-eye.r {
            right: 30%;
        }

        .c-blush {
            width: 14px;
            height: 8px;
            background: #FFB7C5;
            border-radius: 50%;
            position: absolute;
            top: 52%;
            opacity: 0.6;
            filter: blur(1px);
        }

        .c-blush.l {
            left: 18%;
        }

        .c-blush.r {
            right: 18%;
        }

        .c-mouth {
            width: 10px;
            height: 5px;
            border-bottom: 2px solid #1D1D1F;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Hachiware */
        .h-hair {
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            height: 40%;
            background: #87CEEB;
            border-bottom: 2.5px solid #1D1D1F;
            clip-path: polygon(0 0, 100% 0, 100% 100%, 50% 50%, 0 100%);
            border-radius: 48% 48% 0 0;
        }

        .h-ear {
            position: absolute;
            top: -14px;
            width: 28px;
            height: 32px;
            background: #87CEEB;
            border: 2.5px solid #1D1D1F;
            border-radius: 50% 50% 0 0;
            z-index: -1;
        }

        .h-ear.l {
            left: 8px;
            transform: rotate(-10deg);
        }

        .h-ear.r {
            right: 8px;
            transform: rotate(10deg);
        }

        /* --- UI ELEMENTS --- */
        .app-icon {
            width: 64px;
            height: 64px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.2s;
            position: relative;
        }

        .app-icon:active {
            transform: scale(0.9);
        }

        .valentine-icon {
            background: linear-gradient(135deg, #ff2d55, #ff9f0a);
            color: white;
        }

        .ios-btn {
            background: var(--ios-blue);
            color: white;
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 600;
            text-align: center;
            border: none;
            transition: transform 0.2s;
        }

        .ios-btn:active {
            transform: scale(0.97);
            opacity: 0.9;
        }

        /* --- WALLET PASS & APPLE PAY --- */
        .pass-sheet {
            position: fixed;
            bottom: -100%;
            left: 0;
            width: 100%;
            height: 92vh;
            background: #000000;
            border-radius: 30px 30px 0 0;
            transition: bottom 0.6s var(--ease-spring);
            z-index: 500;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 -10px 40px rgba(50, 50, 50, 0.3);
            border-top: 1px solid #333;
        }

        .pass-sheet.open {
            bottom: 0;
        }

        .apple-pay-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .apple-pay-overlay.show {
            opacity: 1;
            pointer-events: all;
        }

        .pay-sheet {
            background: #1c1c1e;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding: 24px;
            transform: translateY(100%);
            transition: transform 0.4s var(--ease-spring);
        }

        .apple-pay-overlay.show .pay-sheet {
            transform: translateY(0);
        }

        /* Checkmark Animation */
        .checkmark-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid #30D158;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.4s var(--ease-spring);
        }

        .processing .checkmark-circle {
            opacity: 1;
            transform: scale(1);
        }

        .processing .spinner {
            display: none;
        }
    </style>
</head>

<body>

    <!-- AUDIO ENGINE -->
    <audio id="bg-music" loop>
        <source src="https://raw.githubusercontent.com/redstrawbery/chiikawa-assets/main/hitorigotsu_guitar_cover.mp3"
            type="audio/mp3">
    </audio>

    <!-- DYNAMIC ISLAND -->
    <div id="dynamic-island">
        <!-- Visualizer -->
        <div class="wave-bars absolute" id="wave-visualizer">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>

        <!-- Choco Notif -->
        <div class="island-content" id="choco-notification">
            <div class="w-8 h-8 rounded-full bg-[#5D4037] flex items-center justify-center text-sm">üç´</div>
            <div class="flex-1 ml-3">
                <div class="text-[9px] text-orange-200 font-bold uppercase tracking-wider">Gift</div>
                <div class="text-xs font-semibold text-white">Chocolate Unlocked</div>
            </div>
            <i data-lucide="check-circle" class="text-green-400 w-4 h-4"></i>
        </div>

        <!-- Payment Notif -->
        <div class="island-content" id="pay-notification">
            <i data-lucide="face-id" class="text-blue-400 w-6 h-6 animate-pulse"></i>
        </div>
    </div>

    <!-- SCENE 1: LOCK SCREEN -->
    <div id="scene-lock" class="scene active">
        <div class="flex flex-col items-center mt-[-100px]">
            <i data-lucide="lock" class="w-6 h-6 mb-4 text-white opacity-60"></i>
            <div class="text-[20px] font-medium opacity-90">Saturday, February 14</div>
            <div class="text-[82px] font-thin leading-none tracking-tight">09:41</div>
        </div>

        <div class="glass-panel w-full max-w-sm rounded-2xl p-4 mt-8 flex items-center gap-3 transform transition hover:scale-[1.02] active:scale-95"
            onclick="unlockPhone()">
            <div class="w-10 h-10 rounded-lg bg-gray-200 flex items-center justify-center">
                <i data-lucide="message-circle" class="text-green-500 fill-green-500"></i>
            </div>
            <div>
                <div class="flex justify-between w-60">
                    <span class="font-bold text-sm">Hachi</span>
                    <span class="text-xs text-gray-400">now</span>
                </div>
                <div class="text-sm opacity-90">I have a surprise for you...</div>
            </div>
        </div>

        <div class="absolute bottom-10 w-full flex flex-col items-center animate-pulse pointer-events-none">
            <div class="w-1/3 h-1 bg-white rounded-full opacity-50 mb-2"></div>
            <p class="text-xs font-medium opacity-60">Swipe up to open</p>
        </div>
    </div>

    <!-- SCENE 2: HOME SCREEN -->
    <div id="scene-home" class="scene">
        <div class="grid grid-cols-4 gap-6 mt-[-60px]">
            <div class="app-icon"><i data-lucide="mail" class="text-blue-400"></i></div>
            <div class="app-icon"><i data-lucide="calendar" class="text-red-500"></i></div>
            <div class="app-icon"><i data-lucide="image" class="text-blue-500"></i></div>
            <div class="app-icon"><i data-lucide="camera" class="text-gray-400"></i></div>

            <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="openApp()">
                <div class="app-icon valentine-icon">
                    <i data-lucide="heart" class="fill-white" size="28"></i>
                </div>
                <span class="text-[11px] font-medium opacity-80">iValentine</span>
            </div>

            <div class="app-icon"><i data-lucide="music" class="text-pink-500"></i></div>
            <div class="app-icon"><i data-lucide="map" class="text-green-500"></i></div>
            <div class="app-icon"><i data-lucide="settings" class="text-gray-400"></i></div>
        </div>

        <div class="absolute bottom-8 w-[90%] h-24 glass-panel rounded-[32px] flex items-center justify-around px-2">
            <div class="app-icon bg-transparent"><i data-lucide="phone" class="text-green-500 fill-green-500"></i></div>
            <div class="app-icon bg-transparent"><i data-lucide="globe" class="text-blue-500"></i></div>
            <div class="app-icon bg-transparent"><i data-lucide="message-square"
                    class="text-green-500 fill-green-500"></i></div>
            <div class="app-icon bg-transparent"><i data-lucide="music" class="text-pink-500 fill-pink-500"></i></div>
        </div>
    </div>

    <!-- SCENE 3: CHAT -->
    <div id="scene-chat" class="scene">
        <div class="w-full h-full bg-black flex flex-col">
            <div
                class="pt-12 pb-2 px-4 glass-panel border-b border-gray-800 flex flex-col items-center sticky top-0 z-10">
                <div class="w-10 h-10 rounded-full bg-gray-700 mb-1 overflow-hidden relative border border-gray-600">
                    <div class="absolute inset-0 bg-[#87CEEB]"></div>
                </div>
                <span class="text-xs text-gray-300">Hachi</span>
            </div>

            <div id="chat-stream" class="flex-1 p-4 flex flex-col gap-2 overflow-y-auto">
                <div class="text-center text-[10px] text-gray-500 font-medium mb-4">iMessage &bull; Today 4:20 PM</div>
            </div>

            <div class="p-3 bg-[#1c1c1e] flex items-center gap-3 pb-8">
                <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-gray-400"><i
                        data-lucide="camera" size="16"></i></div>
                <div
                    class="flex-1 h-9 bg-black border border-gray-700 rounded-full px-4 flex items-center text-sm text-gray-500">
                    iMessage</div>
            </div>
        </div>
        <button id="reply-btn" onclick="startCourage()"
            class="absolute bottom-24 right-6 bg-[#0A84FF] text-white px-6 py-3 rounded-full font-semibold shadow-lg opacity-0 translate-y-10 transition-all duration-500">Reply</button>
    </div>

    <!-- SCENE 4: COURAGE -->
    <div id="scene-courage" class="scene">
        <div class="text-center mb-10">
            <h2 class="text-3xl font-bold mb-2">Give Courage</h2>
            <p class="text-gray-400">Tap Hachi to boost confidence</p>
        </div>

        <div id="hachi-wrapper" class="cursor-pointer transition-transform duration-100 relative mb-12 scale-125"
            onclick="tapHachi(event)">
            <div class="char-wrapper">
                <div class="h-ear l"></div>
                <div class="h-ear r"></div>
                <div class="c-body">
                    <div class="h-hair"></div>
                </div>
                <div class="c-eye l"></div>
                <div class="c-eye r"></div>
                <div class="c-mouth"></div>
                <div id="sweat"
                    class="absolute top-8 right-2 w-3 h-4 bg-blue-400 rounded-full rounded-tr-none opacity-0 transition-opacity">
                </div>
            </div>
        </div>

        <div class="w-64 h-2 bg-gray-800 rounded-full overflow-hidden">
            <div id="courage-fill" class="h-full bg-[#0A84FF] w-0 transition-all duration-200 ease-out"></div>
        </div>
    </div>

    <!-- SCENE 5: PROPOSAL -->
    <div id="scene-proposal" class="scene">
        <div class="glass-panel p-8 rounded-[32px] text-center w-full max-w-sm relative">
            <div class="flex justify-center -space-x-4 mb-6 scale-90">
                <div class="char-wrapper transform -rotate-6">
                    <div class="h-ear l"></div>
                    <div class="h-ear r"></div>
                    <div class="c-body">
                        <div class="h-hair"></div>
                    </div>
                    <div class="c-eye l"></div>
                    <div class="c-eye r"></div>
                    <div class="c-mouth"></div>
                </div>
                <div class="char-wrapper transform rotate-6 z-10">
                    <div class="c-ear l"></div>
                    <div class="c-ear r"></div>
                    <div class="c-body"></div>
                    <div class="c-eye l"></div>
                    <div class="c-eye r"></div>
                    <div class="c-blush l"></div>
                    <div class="c-blush r"></div>
                    <div class="c-mouth"
                        style="content:'w'; border:none; color:#1D1D1F; font-weight:900; font-size:12px; top:48%;">w
                    </div>
                </div>
            </div>

            <h1 class="text-2xl font-bold mb-2">Be my Valentine?</h1>
            <p class="text-gray-400 text-sm mb-8">Feb 14, 2026</p>

            <div class="space-y-3">
                <button onclick="accept()" class="ios-btn bg-[#FF375F]">
                    Yes, absolutely ‚ù§Ô∏è
                </button>
                <button id="no-btn" class="ios-btn bg-gray-800 text-gray-400">
                    No thanks
                </button>
            </div>
        </div>
    </div>

    <!-- WALLET PASS SHEET -->
    <div class="pass-sheet" id="wallet-sheet">
        <div class="w-12 h-1 bg-gray-700 rounded-full mb-8"></div>

        <h2 class="text-2xl font-bold mb-6 tracking-tight text-gray-200">Ticket Locked</h2>

        <div class="w-full max-w-xs bg-[#2c2c2e] rounded-xl overflow-hidden shadow-2xl relative">
            <!-- LOCK OVERLAY -->
            <div class="absolute inset-0 bg-black/60 backdrop-blur-sm z-20 flex flex-col items-center justify-center text-center p-6"
                id="lock-overlay">
                <i data-lucide="lock" class="w-8 h-8 text-gray-400 mb-2"></i>
                <div class="font-bold text-lg mb-1">Payment Required</div>
                <div class="text-xs text-gray-400 mb-4">Complete payment to view ticket</div>
                <button onclick="triggerPayment()"
                    class="bg-black border border-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-900 active:scale-95 transition">
                    Pay with 67 Kisses Ô£ø
                </button>
            </div>

            <div
                class="bg-gradient-to-r from-pink-600 to-purple-600 p-4 flex justify-between items-center text-white relative">
                <div class="flex items-center gap-2"><i data-lucide="ticket"></i> <span class="font-bold">Valentine
                        Pass</span></div>
            </div>

            <div class="p-6 text-white border-b border-gray-700">
                <div class="flex justify-between mb-6">
                    <div>
                        <div class="text-[10px] text-gray-400 uppercase font-bold">Date</div>
                        <div class="text-lg font-medium">Feb 14, 2026</div>
                    </div>
                    <div class="text-right">
                        <div class="text-[10px] text-gray-400 uppercase font-bold">Guest</div>
                        <div class="text-lg font-medium">Chiika</div>
                    </div>
                </div>

                <!-- CHOCOLATE PERK -->
                <div class="bg-[#5D4037] p-3 rounded-lg flex items-center gap-3 mb-2 border border-orange-900">
                    <div class="text-2xl">üç´</div>
                    <div>
                        <div class="text-[10px] text-orange-200 font-bold uppercase">Included Perk</div>
                        <div class="font-bold text-sm">Premium Chocolate</div>
                    </div>
                </div>
            </div>

            <div class="p-4 bg-white flex justify-center opacity-30">
                <div class="w-[90%] h-10 bg-gray-500"></div>
            </div>
        </div>

        <!-- APPLE PAY SHEET -->
        <div class="apple-pay-overlay" id="pay-overlay">
            <div class="pay-sheet w-full">
                <div class="flex justify-between items-start mb-6 border-b border-gray-700 pb-4">
                    <div class="flex gap-3">
                        <div class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center">üç´</div>
                        <div>
                            <div class="text-sm font-medium">Hachiware Store</div>
                            <div class="text-xs text-gray-400">Premium Valentine Bundle</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-400 uppercase">Total</div>
                        <div class="text-xl font-bold">67 Kisses</div>
                    </div>
                </div>

                <div class="mt-8 flex flex-col items-center justify-center min-h-[100px]">
                    <div class="spinner border-2 border-gray-600 border-t-white rounded-full w-8 h-8 animate-spin">
                    </div>
                    <div class="hidden" id="check-icon"><i data-lucide="check" class="text-[#30D158] w-8 h-8"></i></div>
                    <div class="mt-4 text-sm font-medium text-gray-300" id="pay-status">Processing Face ID...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        const audio = document.getElementById('bg-music');
        const island = document.getElementById('dynamic-island');

        // --- CORE FUNCTIONS ---
        function switchScene(id) {
            document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function unlockPhone() {
            audio.volume = 0.5;
            audio.play().then(() => {
                island.classList.add('music-mode');
                document.querySelector('.playing').classList.add('playing');
            }).catch(e => console.log('Audio init later'));
            switchScene('scene-home');
        }

        function openApp() {
            if (audio.paused) audio.play();
            const icon = document.querySelector('.valentine-icon');
            icon.style.transform = 'scale(5)';
            icon.style.opacity = '0';
            setTimeout(() => { switchScene('scene-chat'); startChat(); }, 300);
        }

        // --- CHAT ---
        const messages = [
            { text: "Hey...", sender: "me", delay: 500 },
            { text: "Are you free Feb 14th 2026?", sender: "me", delay: 1500 },
            { text: "I bought something sweet...", sender: "me", delay: 2500 },
            { text: "üç´ ??", sender: "me", delay: 3500 },
        ];

        function startChat() {
            const container = document.getElementById('chat-stream');
            let totalDelay = 0;
            messages.forEach(msg => {
                totalDelay += msg.delay;
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = "bg-[#0A84FF] text-white px-4 py-2 rounded-2xl rounded-br-sm self-end max-w-[75%] mb-2 transform transition-all duration-300 translate-y-4 opacity-0 text-[15px]";
                    bubble.innerText = msg.text;
                    container.appendChild(bubble);
                    requestAnimationFrame(() => bubble.classList.remove('translate-y-4', 'opacity-0'));
                    container.scrollTop = container.scrollHeight;
                }, totalDelay);
            });
            setTimeout(() => {
                const btn = document.getElementById('reply-btn');
                btn.classList.remove('opacity-0', 'translate-y-10');
            }, totalDelay + 500);
        }

        function startCourage() {
            switchScene('scene-courage');
            setTimeout(() => document.getElementById('sweat').style.opacity = 1, 500);
        }

        // --- COURAGE ---
        let courage = 0;
        function tapHachi(e) {
            if (courage >= 100) return;
            const wrapper = document.getElementById('hachi-wrapper');
            wrapper.style.transform = "scale(1.15)";
            setTimeout(() => wrapper.style.transform = "scale(1.25)", 100);
            courage += 15;
            document.getElementById('courage-fill').style.width = `${Math.min(courage, 100)}%`;
            if (courage >= 100) {
                document.getElementById('courage-fill').style.backgroundColor = "#30D158";
                setTimeout(() => switchScene('scene-proposal'), 600);
            }
        }

        // --- NO BUTTON ---
        const noBtn = document.getElementById('no-btn');
        let dodgeCount = 0;
        function moveNo() {
            dodgeCount++;
            if (dodgeCount >= 3) {
                noBtn.style.transform = "translate(0,0)";
                noBtn.innerText = "YES (Want Choco)";
                noBtn.classList.remove('bg-gray-800', 'text-gray-400');
                noBtn.classList.add('bg-[#5D4037]', 'text-white');
                noBtn.onclick = accept;
                return;
            }
            const x = (Math.random() - 0.5) * 120;
            const y = (Math.random() - 0.5) * 80;
            noBtn.style.transform = `translate(${x}px, ${y}px)`;
        }
        noBtn.addEventListener('mouseover', moveNo);
        noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); moveNo(); });

        // --- ACCEPT & PAY FLOW ---
        function accept() {
            confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 }, colors: ['#FF375F', '#5D4037', '#ffffff'] });

            // Island Update
            island.classList.remove('music-mode');
            island.classList.add('choco-mode');
            document.getElementById('wave-visualizer').style.display = 'none';
            document.getElementById('choco-notification').classList.add('show-content');

            setTimeout(() => {
                document.getElementById('wallet-sheet').classList.add('open');
            }, 2500);
        }

        function triggerPayment() {
            const overlay = document.getElementById('pay-overlay');
            const island = document.getElementById('dynamic-island');

            overlay.classList.add('show');
            document.getElementById('choco-notification').style.display = 'none';
            island.classList.remove('choco-mode');
            island.classList.add('pay-mode');
            document.getElementById('pay-notification').classList.add('show-content');

            setTimeout(() => {
                document.querySelector('.spinner').style.display = 'none';
                document.getElementById('check-icon').classList.remove('hidden');
                document.getElementById('pay-status').innerText = "Payment Successful";

                // Success
                setTimeout(() => {
                    overlay.classList.remove('show');
                    document.getElementById('lock-overlay').style.opacity = '0';
                    document.getElementById('lock-overlay').style.pointerEvents = 'none';
                    island.classList.remove('pay-mode');
                    island.classList.add('music-mode');
                }, 1000);
            }, 2000);
        }

    </script>
</body>

</html>
